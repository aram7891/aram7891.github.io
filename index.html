 <!DOCTYPE html>
 <html lang="es" class="scroll-smooth">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Andrés Ramírez | Clarity Before Connection</title>
     
     <!-- Optimizaciones SEO (Tono Intelectual y de Autor) -->
     <meta name="description" content="Andrés Ramírez es autor de Mindful Match y Don’t Lose Yourself While Dating. Ensayos clínicos sobre discernimiento, capital emocional y claridad antes que conexión.">
     <meta name="keywords" content="Andrés Ramírez, Clarity Before Connection, capital emocional, dinámicas relacionales, autoconocimiento, ensayos, Mindful Match, Don't Lose Yourself While Dating">
     <meta name="author" content="Andrés Ramírez">
     <meta property="og:title" content="Andrés Ramírez | Clarity Before Connection">
-    <meta property="og:description" content="Autor. >
+    <meta property="og:description" content="Autor de ensayos sobre discernimiento relacional, capital emocional y claridad personal antes que conexión.">
     <meta property="og:type" content="website">
     <meta property="og:url" content="https://www.andresramirez.pro">
     <link rel="canonical" href="https://www.andresramirez.pro">
     <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1">
     
     <!-- Schema.org para Autor y Libros -->
     <script type="application/ld+json">
     {
       "@context": "https://schema.org",
       "@graph": [
         {
           "@type": "Person",
           "@id": "https://www.andresramirez.pro/#person",
           "name": "Andrés Ramírez",
           "url": "https://www.andresramirez.pro",
           "jobTitle": "Author",
           "knowsAbout": ["Relational Dynamics", "Emotional Capital", "Self-Awareness", "Cognitive Liquidity"]
         },
         {
           "@type": "Book",
           "name": "Match Consciente",
           "author": {"@id": "https://www.andresramirez.pro/#person"},
           "inLanguage": "es"
         },
         {
@@ -100,50 +95,55 @@ este es, solo no cambies nada del contenido :
             transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; position: relative; z-index: 60;
         }
         .banner-content { flex: 1; text-align: center; padding: 10px 40px; }
         .close-banner-btn {
             position: absolute; right: 15px; display: flex; align-items: center; justify-content: center;
             width: 24px; height: 24px; cursor: pointer; opacity: 0.6; transition: opacity 0.2s;
         }
         .close-banner-btn:hover { opacity: 1; }
 
         /* Estilo editorial neutral en blanco y negro permanente */
         .author-photo { filter: grayscale(100%); object-fit: cover; }
         
         .essay-card {
             background: #ffffff; border: 1px solid #E4E4E7; padding: 2.5rem 2rem;
             display: flex; flex-direction: column; transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1); height: 100%;
         }
         .essay-card:hover { border-color: #1A1A1A; transform: translateY(-8px); box-shadow: 0 30px 60px -20px rgba(0,0,0,0.08); }
 
         .read-btn {
             display: inline-block; margin-top: auto; padding: 12px 0; font-size: 10px;
             font-weight: 700; letter-spacing: 0.2em; text-transform: uppercase;
             border-bottom: 1px solid #1A1A1A; color: #1A1A1A; transition: all 0.3s ease; text-decoration: none; cursor: pointer;
         }
         .read-btn:hover { opacity: 0.5; letter-spacing: 0.3em; }
 
+        
+        .step-circle { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
+        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
+        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
+
         .spinner {
             border: 2px solid rgba(0, 0, 0, 0.1); width: 18px; height: 18px; border-radius: 50%;
             border-left-color: #1A1A1A; animation: spin 1s linear infinite; display: inline-block; margin-right: 8px;
         }
         @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
 
         #mobile-menu { backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); background-color: rgba(250, 250, 250, 0.85); }
 
         .essay-tab {
             cursor: pointer; padding: 8px 20px; font-size: 10px; font-weight: 700; letter-spacing: 0.15em;
             text-transform: uppercase; border-bottom: 2px solid transparent; transition: all 0.3s ease; color: #71717A;
         }
         .essay-tab.active { border-bottom-color: #1A1A1A; color: #1A1A1A; }
         
         .lang-switch {
             font-size: 10px; letter-spacing: 0.1em; cursor: pointer; padding: 4px 12px;
             border: 1px solid #E4E4E7; transition: all 0.2s ease; font-weight: 700;
         }
         .lang-active { background: #1A1A1A; color: #FAFAFA; border-color: #1A1A1A; }
     </style>
 </head>
 <body class="font-sans antialiased selection:bg-accent selection:text-paper">
 
     <header class="fixed top-0 w-full z-50">
         <div id="announcement-banner" class="bg-ink text-paper text-[9px] md:text-[10px] uppercase tracking-[0.2em] font-bold">
@@ -195,88 +195,131 @@ este es, solo no cambies nada del contenido :
             <p class="text-xs font-bold tracking-widest uppercase text-accent mb-6" data-i18n="hero-kicker">
                 Autor
             </p>
             
             <h1 class="font-serif text-5xl md:text-6xl lg:text-7xl font-bold leading-tight mb-8 text-ink" data-i18n="hero-title">
                 Claridad antes que Conexión.
             </h1>
             
             <p class="text-xl md:text-2xl text-subtle leading-relaxed mb-10 border-l-4 border-accent/40 pl-6" data-i18n="hero-subtitle">
                 Porque el costo de amar sin discernir es perderte a ti mismo.
             </p>
             
             <div class="flex flex-col sm:flex-row gap-4 mt-4">
                 <a href="javascript:void(0)" onclick="scrollToSection('essays')" class="px-8 py-3 bg-accent text-white text-lg font-serif italic hover:bg-opacity-90 transition-all shadow-sm text-center rounded-sm" data-i18n="hero-btn-read">
                     Leer mis escritos
                 </a>
                 <a href="javascript:void(0)" onclick="scrollToSection('ai-tools')" class="px-8 py-3 bg-transparent text-ink text-lg font-serif italic border border-divider hover:border-ink transition-all shadow-sm text-center flex items-center justify-center rounded-sm" data-i18n="hero-btn-more">
                     Más sobre mí
                 </a>
             </div>
         </div>
 
         <!-- Bloque de Imagen (Derecha) -->
         <div class="flex-1 flex justify-center md:justify-end w-full">
             <div class="w-64 h-64 md:w-80 md:h-80 lg:w-[400px] lg:h-[400px] overflow-hidden rounded-full border border-divider shadow-sm bg-zinc-100">
-                <img src="https://raw.githubusercontent.com/aram7891/aram7891.github.io/main/unnamed%20(1).jpg" alt="Andrés Ramírez Portrait" class="author-photo w-full h-full">
+                <img src="assets/images/andres-ramirez-portrait.jpg" alt="Andrés Ramírez Portrait" class="author-photo w-full h-full">
             </div>
         </div>
     </section>
 
-    <section id="ai-tools" class="py-32 px-6 md:px-12 bg-white border-t border-b border-divider">
+    <section id="ai-tools" class="py-24 px-6 md:px-12 bg-white border-t border-b border-divider">
         <div class="max-w-5xl mx-auto">
-            <div class="text-center mb-16">
-                <span class="text-[10px] font-bold tracking-widest uppercase text-subtle mb-2 block" data-i18n="tools-label">Laboratorio de Discernimiento</span>
-                <h2 class="font-serif text-4xl mb-4" data-i18n="tools-title">Interacción con la Claridad</h2>
-                <p class="text-subtle text-sm max-w-xl mx-auto" data-i18n="tools-desc">Análisis metodológico de dinámicas relacionales y auditoría técnica de capital emocional.</p>
+            <header class="mb-12 border-b border-divider pb-10">
+                <p class="text-[10px] uppercase tracking-[0.3em] text-accent font-bold">SelfLoveClub</p>
+                <h2 class="mt-4 font-serif text-4xl sm:text-5xl font-bold tracking-tight">Laboratorio de Discernimiento</h2>
+                <p class="mt-6 text-subtle max-w-2xl text-sm sm:text-base leading-relaxed italic">
+                    Utiliza herramientas técnicas para ganar claridad emocional y estratégica. Convierte la confusión en datos accionables.
+                </p>
+                <div class="mt-8">
+                    <a href="javascript:void(0)" onclick="scrollToSection('home')" class="text-[10px] font-bold uppercase tracking-widest border-b border-ink pb-1 hover:opacity-50 transition">Volver al inicio</a>
+                </div>
+            </header>
+
+            <div class="mb-12" aria-label="Progreso del flujo">
+                <ol class="flex items-center justify-between gap-4 md:gap-8 relative">
+                    <li class="flex-1 flex flex-col md:flex-row items-center gap-3">
+                        <span id="stepCircle1" class="step-circle w-10 h-10 rounded-full bg-ink text-white flex items-center justify-center text-sm font-bold shadow-lg">1</span>
+                        <span class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-ink text-center md:text-left">Discernimiento</span>
+                    </li>
+                    <li class="hidden md:block h-px flex-1 bg-divider"></li>
+                    <li class="flex-1 flex flex-col md:flex-row items-center gap-3">
+                        <span id="stepCircle2" class="step-circle w-10 h-10 rounded-full bg-white border border-divider text-subtle flex items-center justify-center text-sm font-bold">2</span>
+                        <span class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-subtle text-center md:text-left">Perspectiva</span>
+                    </li>
+                    <li class="hidden md:block h-px flex-1 bg-divider"></li>
+                    <li class="flex-1 flex flex-col md:flex-row items-center gap-3">
+                        <span id="stepCircle3" class="step-circle w-10 h-10 rounded-full bg-white border border-divider text-subtle flex items-center justify-center text-sm font-bold">3</span>
+                        <span class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-subtle text-center md:text-left">Nota de Campo</span>
+                    </li>
+                </ol>
             </div>
 
-            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
-                <div class="gemini-container p-10 flex flex-col shadow-sm border border-divider">
-                    <h3 class="font-serif text-2xl mb-2 tracking-tight" data-i18n="tool1-title">Discernimiento Relacional</h3>
-                    <p class="text-[9px] text-accent mb-6 uppercase tracking-[0.2em] font-bold" data-i18n="tool1-subtitle">Perspectiva Técnica</p>
-                    <textarea id="situationInput" rows="5" class="w-full p-4 text-sm border border-divider rounded-none bg-paper focus:outline-none focus:ring-1 focus:ring-ink mb-6" placeholder="..."></textarea>
-                    <button onclick="analyzeClarity()" id="analyzeBtn" class="w-full py-4 bg-ink text-white text-[10px] uppercase tracking-[0.2em] font-bold hover:bg-opacity-90 transition-all flex items-center justify-center">
-                        <span id="analyzeSpinner" class="spinner hidden"></span>
-                        <span id="analyzeBtnText" data-i18n="btn-analyze">Obtener Perspectiva</span>
+            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
+                <article class="lg:col-span-1 bg-white border border-divider rounded-sm p-8 shadow-sm flex flex-col">
+                    <h3 class="font-serif text-xl font-bold mb-6">Paso 1 · El Escenario</h3>
+                    <label for="situationInput" class="text-[10px] uppercase tracking-widest font-bold text-subtle mb-3 block">Describe la situación</label>
+                    <textarea id="situationInput" rows="12" class="w-full rounded-sm border border-divider p-4 text-sm focus:outline-none focus:ring-1 focus:ring-ink bg-paper leading-relaxed resize-none" placeholder="Ejemplo: Estoy invirtiendo energía en una dinámica ambigua y no sé si es conexión real o miedo a la soledad..."></textarea>
+                    <p class="mt-4 text-[10px] text-accent italic">Marco sugerido: autoconocimiento económico + costo de oportunidad.</p>
+                </article>
+
+                <article class="lg:col-span-1 bg-white border border-divider rounded-sm p-8 shadow-sm flex flex-col">
+                    <h3 class="font-serif text-xl font-bold mb-6">Paso 2 · Perspectiva</h3>
+                    <button onclick="analyzeClarity()" id="analyzeBtn" class="w-full inline-flex items-center justify-center bg-ink text-white px-6 py-4 text-[10px] font-bold uppercase tracking-[0.2em] hover:bg-zinc-800 transition shadow-sm">
+                        <span id="analyzeSpinner" class="spinner hidden mr-3"></span>
+                        Obtener Perspectiva Técnica
                     </button>
-                    <div id="clarityResult" class="mt-8 text-sm leading-relaxed hidden border-t border-divider pt-8 italic text-ink"></div>
-                </div>
 
-                <div class="gemini-container p-10 flex flex-col shadow-sm border border-divider">
-                    <h3 class="font-serif text-2xl mb-2 tracking-tight" data-i18n="tool2-title">Auditoría Emocional</h3>
-                    <p class="text-[9px] text-accent mb-6 uppercase tracking-[0.2em] font-bold" data-i18n="tool2-subtitle">Patrones de Activo/Pasivo</p>
-                    <input id="patternInput" type="text" class="w-full p-4 text-sm border border-divider rounded-none bg-paper focus:outline-none focus:ring-1 focus:ring-ink mb-6" placeholder="...">
-                    <button onclick="generateFieldNote()" id="noteBtn" class="w-full py-4 border border-ink text-ink text-[10px] uppercase tracking-[0.2em] font-bold hover:bg-ink hover:text-white transition-all flex items-center justify-center">
-                        <span id="noteSpinner" class="spinner hidden"></span>
-                        <span id="noteBtnText" data-i18n="btn-generate">Generar Nota de Campo</span>
-                    </button>
-                    <div id="noteResult" class="mt-8 p-6 bg-paper border border-divider rounded-none text-[10px] hidden">
-                        <span class="block font-bold mb-3 uppercase tracking-[0.2em] text-subtle" data-i18n="record-label">Registro de Auditoría</span>
-                        <div id="noteContent" class="text-ink leading-relaxed"></div>
+                    <div id="perspectiveOutput" class="hidden mt-8 fade-in rounded-sm border-l-2 border-accent bg-paper p-5 text-sm leading-relaxed italic text-ink"></div>
+
+                    <div class="mt-10 pt-8 border-t border-divider">
+                        <label for="emotionInput" class="text-[10px] uppercase tracking-widest font-bold text-subtle mb-3 block">Auditoría Emocional</label>
+                        <input id="emotionInput" type="text" class="w-full rounded-sm border border-divider p-4 text-sm focus:outline-none focus:ring-1 focus:ring-ink bg-paper" placeholder="Ejemplo: ansiedad, culpa, esperanza" />
                     </div>
-                </div>
+
+                    <div class="mt-6">
+                        <label for="patternInput" class="text-[10px] uppercase tracking-widest font-bold text-subtle mb-3 block">Patrones Detectados</label>
+                        <input id="patternInput" type="text" class="w-full rounded-sm border border-divider p-4 text-sm focus:outline-none focus:ring-1 focus:ring-ink bg-paper" placeholder="Ejemplo: complacer por miedo, evasión" />
+                    </div>
+                </article>
+
+                <article class="lg:col-span-1 bg-white border border-divider rounded-sm p-8 shadow-sm flex flex-col">
+                    <h3 class="font-serif text-xl font-bold mb-6">Paso 3 · La Nota</h3>
+                    <button onclick="generateFieldNote()" id="noteBtn" class="w-full inline-flex items-center justify-center border border-ink text-ink px-6 py-4 text-[10px] font-bold uppercase tracking-[0.2em] hover:bg-ink hover:text-white transition shadow-sm">
+                        <span id="noteSpinner" class="spinner hidden mr-3"></span>
+                        Generar Nota de Campo
+                    </button>
+
+                    <div id="noteOutput" class="hidden mt-8 fade-in rounded-sm bg-ink text-paper p-6 text-[11px] leading-relaxed font-mono"></div>
+
+                    <figure class="mt-auto pt-10 group">
+                        <div class="overflow-hidden rounded-sm border border-divider">
+                            <img src="assets/images/andres-ramirez-portrait.jpg" alt="SelfLoveClub Lab" class="w-full h-auto grayscale group-hover:grayscale-0 transition duration-700" />
+                        </div>
+                        <figcaption class="mt-3 text-[9px] uppercase tracking-widest text-subtle text-center">Protocolo de Discernimiento v2.0</figcaption>
+                    </figure>
+                </article>
             </div>
         </div>
     </section>
 
     <!-- SECCIÓN DE LIBROS PREMIUM (Tono de Autor Intelectual) - PORTADAS DE TEXTO -->
     <section id="books" class="py-32 px-6 md:px-12 bg-paper">
         <div class="max-w-6xl mx-auto">
             <div class="text-center mb-16">
                 <span class="text-[10px] font-bold tracking-widest uppercase text-subtle mb-3 block" data-i18n="books-label">Obras Publicadas</span>
                 <h2 class="font-serif text-4xl md:text-5xl text-ink" data-i18n="books-sec-title">Libros</h2>
             </div>
 
             <!-- Contenedor de Libros en Español -->
             <div id="books-grid-es" class="grid grid-cols-1 md:grid-cols-2 gap-8 transition-opacity duration-500">
                 <!-- Match Consciente -->
                 <div class="essay-card flex flex-col sm:flex-row gap-8 items-center sm:items-start group">
                     <div class="w-32 sm:w-40 shrink-0 aspect-[2/3] bg-ink text-paper flex flex-col justify-between p-4 md:p-5 shadow-lg group-hover:scale-105 transition-transform duration-700 ease-out select-none">
                         <div class="text-[7px] md:text-[8px] uppercase tracking-[0.2em] opacity-70">Obra Principal</div>
                         <div class="font-serif text-lg md:text-xl leading-tight">Match<br>Consciente</div>
                         <div class="text-[7px] md:text-[8px] uppercase tracking-[0.2em] border-t border-white/20 pt-2">Andrés Ramírez</div>
                     </div>
 
                     <div class="flex flex-col flex-1 h-full text-center sm:text-left">
                         <span class="text-[9px] text-accent uppercase tracking-[0.2em] font-bold mb-2">Libro Teórico</span>
                         <h3 class="font-serif text-2xl mb-3 text-ink">Match Consciente</h3>
@@ -410,51 +453,51 @@ este es, solo no cambies nada del contenido :
                     <a href="https://raw.githubusercontent.com/aram7891/aram7891.github.io/main/2%20Emotional%20Arbitrage%20Profiting%20from%20Regulation%20in%20Decision%20Making.pdf" target="_blank" class="read-btn">Read Essay (PDF)</a>
                 </div>
             </div>
         </div>
     </section>
 
     <!-- SECCIÓN SELF LOVE CLUB -->
     <section id="selfloveclub" class="py-32 border-t border-divider bg-white">
         <div class="max-w-3xl mx-auto px-6 text-center">
             <h2 class="font-serif text-4xl md:text-5xl text-ink mb-6" data-i18n="slc-title">SelfLoveClub</h2>
             <p class="text-xl md:text-2xl text-subtle mb-8 font-serif italic" data-i18n="slc-subtitle">
                 Una plataforma conceptual dedicada a la claridad, el respeto propio y las decisiones relacionales conscientes.
             </p>
             <p class="text-sm text-subtle max-w-2xl mx-auto mb-12 leading-relaxed" data-i18n="slc-desc">
                 SelfLoveClub funciona como un proyecto de investigación cultural, combinando ensayos, artefactos digitales y experimentos comunitarios sobre el discernimiento emocional y la soberanía personal.
             </p>
             <a href="https://instagram.com/selfloveclubusa" target="_blank" class="read-btn" data-i18n="slc-link">
                 Explorar SelfLoveClub en Instagram
             </a>
         </div>
     </section>
 
     <footer class="py-32 px-6 border-t border-divider bg-paper text-center">
         <div class="max-w-4xl mx-auto flex flex-col items-center">
             <div class="w-16 h-16 mb-8 overflow-hidden rounded-full border border-divider">
-                <img src="https://raw.githubusercontent.com/aram7891/aram7891.github.io/main/unnamed%20(1).jpg" alt="AR" class="author-photo w-full h-full">
+                <img src="assets/images/andres-ramirez-portrait.jpg" alt="AR" class="author-photo w-full h-full">
             </div>
             <div class="font-serif text-2xl mb-4 tracking-[0.3em] uppercase font-bold text-ink">ANDRÉS RAMÍREZ</div>
             <p class="text-[10px] text-subtle uppercase tracking-[0.3em] mb-12 italic">Florida, USA | andres@selfloveclubstore.com</p>
             <div class="flex flex-wrap justify-center gap-10 text-[10px] font-bold uppercase tracking-[0.3em] text-subtle mb-16">
                 <a href="https://www.threads.net/@selfloveclubusa" target="_blank" class="hover:text-ink">Threads</a>
                 <a href="https://www.instagram.com/selfloveclubusa" target="_blank" class="hover:text-ink">Instagram</a>
                 <a href="https://x.com/selfloveclubusa" target="_blank" class="hover:text-ink">X</a>
             </div>
             <div class="text-[8px] text-gray-400 uppercase tracking-[0.4em]">&copy; 2026 Andrés Ramírez. All rights reserved.</div>
         </div>
     </footer>
 
     <script>
         const translations = {
             es: {
                 "nav-home": "Inicio", "nav-tools": "Herramientas", "nav-books": "Libros", "nav-archive": "Archivo",
                 "close": "Cerrar", 
                 "hero-kicker": "Autor",
                 "hero-title": "Claridad antes que Conexión.",
                 "hero-subtitle": "Porque el costo de amar sin discernir es perderte a ti mismo.",
                 "hero-btn-read": "Leer mis escritos",
                 "hero-btn-more": "Más sobre mí",
                 "banner-text": "HAZ DE LA LECTURA TU HERRAMIENTA DE CRECIMIENTO PERSONAL ¡DESCUBRE MIS OBRAS!",
                 "banner-link": "EXPLORAR LIBROS",
                 "tools-label": "Laboratorio de Discernimiento", "tools-title": "Interacción con la Claridad",
@@ -571,72 +614,97 @@ este es, solo no cambies nada del contenido :
         async function callGemini(prompt, systemPrompt) {
             let retries = 0;
             const delay = (ms) => new Promise(res => setTimeout(res, ms));
             while (retries < 5) {
                 try {
                     const response = await fetch('/api/gemini', {
                         method: 'POST',
                         headers: { 'Content-Type': 'application/json' },
                         body: JSON.stringify({ prompt, systemPrompt })
                     });
                     const result = await response.json();
 
                     if (result.error) {
                         console.error("Error del servidor:", result.error);
                         return "Error procesando la solicitud. Asegúrate de configurar la API Key.";
                     }
 
                     return result.candidates?.[0]?.content?.parts?.[0]?.text;
                 } catch (e) {
                     retries++;
                     await delay(Math.pow(2, retries) * 1000);
                 }
             }
             return "Error de conexión. Por favor, intenta de nuevo.";
         }
+        function setStepState(activeStep) {
+            const circles = [
+                document.getElementById('stepCircle1'),
+                document.getElementById('stepCircle2'),
+                document.getElementById('stepCircle3')
+            ].filter(Boolean);
+
+            circles.forEach((circle, idx) => {
+                const step = idx + 1;
+                circle.classList.remove('bg-ink', 'bg-accent', 'text-white', 'shadow-lg');
+                circle.classList.add('bg-white', 'text-subtle', 'border', 'border-divider');
+
+                if (step === activeStep) {
+                    circle.classList.remove('bg-white', 'text-subtle', 'border', 'border-divider');
+                    circle.classList.add('bg-ink', 'text-white', 'shadow-lg');
+                } else if (step < activeStep) {
+                    circle.classList.remove('bg-white', 'text-subtle', 'border', 'border-divider');
+                    circle.classList.add('bg-accent', 'text-white');
+                }
+            });
+        }
 
         async function analyzeClarity() {
             const input = document.getElementById('situationInput');
-            const resultDiv = document.getElementById('clarityResult');
+            const resultDiv = document.getElementById('perspectiveOutput');
             const btn = document.getElementById('analyzeBtn');
             const spinner = document.getElementById('analyzeSpinner');
             if (!input.value.trim()) return;
 
             btn.disabled = true; spinner.classList.remove('hidden');
             resultDiv.classList.add('hidden');
 
             const systemPrompt = aiPrompts[currentLang].clarity;
             const text = await callGemini(input.value, systemPrompt);
-
-            const formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
+            const formattedText = `“${(text || '').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>')}”`;
 
             resultDiv.innerHTML = formattedText;
             resultDiv.classList.remove('hidden');
+            setStepState(2);
             btn.disabled = false; spinner.classList.add('hidden');
         }
 
         async function generateFieldNote() {
-            const input = document.getElementById('patternInput');
-            const resultDiv = document.getElementById('noteResult');
-            const contentDiv = document.getElementById('noteContent');
+            const situation = document.getElementById('situationInput').value.trim();
+            const emotions = (document.getElementById('emotionInput')?.value || '').trim();
+            const patterns = document.getElementById('patternInput').value.trim();
+            const resultDiv = document.getElementById('noteOutput');
             const btn = document.getElementById('noteBtn');
             const spinner = document.getElementById('noteSpinner');
-            if (!input.value.trim()) return;
+            if (!situation || !emotions || !patterns) return;
 
             btn.disabled = true; spinner.classList.remove('hidden');
             resultDiv.classList.add('hidden');
 
             const systemPrompt = aiPrompts[currentLang].audit;
-            const text = await callGemini(input.value, systemPrompt);
+            const prompt = `SITUACIÓN: ${situation}
+EMOCIONES: ${emotions}
+PATRONES: ${patterns}`;
+            const text = await callGemini(prompt, systemPrompt);
+            const formattedText = (text || '').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
 
-            const formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
-
-            contentDiv.innerHTML = formattedText;
+            resultDiv.innerHTML = formattedText;
             resultDiv.classList.remove('hidden');
+            setStepState(3);
             btn.disabled = false; spinner.classList.add('hidden');
         }
 
         setLanguage('es');
+        setStepState(1);
     </script>
 </body>
 </html>
-
 
EOF
)
  
